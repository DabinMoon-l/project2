# 📱 RabbiTory - PRD (Product Requirements Document)

## 1. 개요

### 1.1 프로젝트 소개
대학 수업 보조 앱. 퀴즈 + 게시판 기능에 용사 컨셉 게이미피케이션 적용.
학생들의 자발적 학습 참여 유도 + 교수님의 문제 피드백 수집.

### 1.2 목표
- 학생: 재미있게 퀴즈 풀고, 서로 질의응답하며 학습
- 교수님: 문제에 대한 피드백 수집, 학생 참여도 모니터링

### 1.3 타겟 사용자
```
1학기
├── 1학년: 생물학 (60명)
└── 2학년: 미생물학 (160명)

2학기
└── 1학년: 병태생리학 (160명)
```

### 1.4 기술 스택
- Frontend: Next.js 15 + React 19 + TypeScript + Tailwind CSS
- Backend: Firebase Firestore, Cloud Functions
- 배포: PWA (Vercel)
- OCR: Tesseract.js
- PDF: pdfjs-dist
- AI: Gemini API (문제 생성)
- 인증: Firebase Auth (Apple / Google / Naver / Email)

---

## 2. UI 테마 (빈티지 신문 스타일)

### 2.1 기본 색상
| 용도 | 색상 |
|------|------|
| 배경 | #F5F0E8 (크림) |
| 주요 텍스트/테두리 | #1A1A1A (검정) |
| 보조 배경 | #EDEAE4 |
| 음소거 텍스트 | #5C5C5C |
| 성공 | #1A6B1A (녹색) |
| 오류 | #8B1A1A (빨강) |

### 2.2 스타일 특징
- **둥근 모서리 없음** (rounded-none)
- 신문 느낌의 타이포그래피
- 세리프 폰트 조합

### 2.3 반별 테마
| 반 | 메인 배경 | 강조색 |
|---|----------|--------|
| A반 | #4A0E0E (버건디) | #D4AF37 (골드) |
| B반 | #F5E6C8 (크림) | #3D2B1F (브라운) |
| C반 | #0D3D2E (에메랄드) | #C0C0C0 (실버) |
| D반 | #1A2744 (네이비) | #CD7F32 (브론즈) |

### 2.4 온보딩 반 선택 아이콘 색상
| 반 | 색상 |
|---|------|
| A | #EF4444 (빨강) |
| B | #EAB308 (노랑) |
| C | #22C55E (초록) |
| D | #3B82F6 (파랑) |

---

## 3. 사용자 유형

### 3.1 학생
- 소셜 로그인 (Apple / Google / Naver) 또는 이메일 인증
- 학적정보 입력 (학년 / 반 / 과목 / 이름 / 학번)
- 반 선택: A / B / C / D
- 캐릭터 생성 + 닉네임 설정

### 3.2 교수님
- 특정 이메일로 로그인 시 관리자 모드 자동 전환
- 퀴즈 생성/관리, 학생 통계 조회, 피드백 확인

---

## 4. 로그인 플로우

```
앱 시작
    ↓
소셜 로그인 선택 (Apple / Google / Naver) 또는 이메일 인증
    ↓
학적정보 입력
- 학년 선택
- 반 선택 (A / B / C / D)
- 과목 (자동 배정)
- 이름
- 학번
    ↓
캐릭터 생성 (귀여운 토끼 캐릭터)
- 머리스타일 (짧은/중간/긴 등)
- 피부색 (다양한 색상)
- 수염 (없음/콧수염/턱수염/풀수염)
    ↓
닉네임 설정
    ↓
튜토리얼 (스킵 가능)
    ↓
홈 화면
```

---

## 5. 화면 구조

### 5.1 학생 네비게이션
```
│  🏠  │  📝  │  📚  │  📰  │
│  홈  │ 퀴즈 │ 복습 │ 뉴스 │
```

### 5.2 교수님 네비게이션
```
│  🏠  │  📝  │  📰  │
│  홈  │ 퀴즈 │ 뉴스 │
```

---

## 6. 퀴즈 화면

### 6.1 퀴즈 목록
- 탭 필터: [전체] [중간] [기말] [족보] [자작]
- 과목별 리본 배너 (생물학/미생물학/병태생리학)
- **완료된 퀴즈**: 50% 검정 오버레이 + "완료" 뱃지 표시
- 퀴즈 업데이트 알림 (문제 수정됨 표시)

### 6.2 퀴즈 카드 정보
- 퀴즈 제목
- 문제 유형 아이콘 + 개수
- 태그 (챕터/주제)
- 난이도 (쉬움/보통/어려움)
- 상태: 완료(점수) / NEW / 미응시
- 자작 퀴즈: 제작자 닉네임 + 좋아요 수 + 참여자 수

### 6.3 문제 유형

#### 학생이 만들 수 있는 유형
| 유형 | 설명 |
|------|------|
| OX | 참/거짓 문제 |
| 객관식 | 2~8개 선지 지원, 복수정답 가능 |
| 주관식 | 단답형 (내부적으로 short_answer) |
| 결합형 | 공통 지문/이미지 + 하위 문제들 |

#### 교수님 추가 유형
| 유형 | 설명 |
|------|------|
| 서술형 | 긴 답변 + 루브릭 채점 (AI 보조/수동) |

### 6.4 퀴즈 생성
- **직접 입력**: 문제/선지/정답/해설 직접 작성
- **OCR 업로드**: 사진/PDF → Tesseract OCR → 텍스트 추출 → 자동 입력
- **AI 생성** (서재): 이미지/텍스트 업로드 → Gemini API → 문제 자동 생성
- OCR 진행률 표시 및 취소 기능 지원

### 6.5 결합형 문제
- **공통 지문**: 텍스트 박스 또는 ㄱ.ㄴ.ㄷ. 형식
- **공통 이미지**: 별도 업로드
- **필수 조건**: 공통 지문 OR 공통 이미지 중 하나 이상
- **하위 문제**: OX, 객관식, 단답형 (서술형 제외)
- **문제 수 계산**: 하위 문제 N개 = N문제로 계산

### 6.6 퀴즈 풀이 화면
- 헤더: 뒤로가기 + 제목 + 진행도 (3/10)
- 문제 텍스트 + 이미지 (있는 경우)
- 선지 버튼들 (OX/객관식) 또는 입력창 (주관식)
- 이전/다음 네비게이션

### 6.7 결과 화면
- 점수 표시 (정답 개수 / 총 문제 수)
- 문제별 정답/오답 표시
- 해설 확인 가능
- 오답은 자동으로 복습창에 저장
- **AI 생성 퀴즈**: 선지별 해설 표시 (왜 맞는지/틀린지)

### 6.8 피드백 화면
- **6가지 피드백 타입 선택**:
  - 긍정적 피드백 (녹색):
    - 문제가 좋아요!
    - 더 풀고 싶어요
  - 개선 피드백 (검정):
    - 문제가 이해 안 돼요
    - 정답이 틀린 것 같아요
    - 오타가 있어요
    - 기타 의견
- 추가 의견 텍스트 입력 (선택)
- 문제별로 피드백 남기기
- **AI 생성 퀴즈는 피드백 페이지 스킵** (결과 → EXP 화면으로 직행)

### 6.9 퀴즈 관리 (본인 퀴즈)
- 통계: 참여자 수, 평균 점수, 문제별 정답률
- 수정: 문제/선지/정답/해설 편집
- 삭제: 퀴즈 삭제
- **AI 생성 퀴즈**: 피드백/수정 버튼 숨김

---

## 7. AI 퀴즈 생성 (서재)

### 7.1 플로우
1. 플로팅 AI 버튼 클릭
2. 이미지/텍스트 업로드 + 폴더명/태그/난이도/문제 수 설정
3. Gemini API로 문제 생성
4. 바로 연습 모드 시작 (ReviewPractice)
5. 완료 후 서재에 저장

### 7.2 AI 생성 문제 특징
- **선지별 해설** (choiceExplanations): 각 선지가 왜 맞는지/틀린지 설명
- 오답 선택 시 해당 선지의 해설 표시
- 정답 선지 해설도 함께 표시
- type: 'ai-generated'로 저장

### 7.3 서재 기능
- AI 생성 퀴즈 목록 조회
- 공개 업로드: 서재 → 자작 퀴즈로 전환
- 삭제 기능

---

## 8. 복습 화면

### 8.1 탭 구조
- [오답] - 틀린 문제
- [찜] - 북마크한 문제
- [푼 문제] - 완료한 퀴즈의 모든 문제
- [서재] - AI 생성 퀴즈

### 8.2 폴더 구조
- 퀴즈별로 폴더 형태로 그룹화
- 폴더 카드: 제목, 문제 수, 태그, 난이도
- 폴더 삭제 시 해당 퀴즈가 퀴즈 목록에 다시 표시됨

### 8.3 폴더 상세 화면
- 문제 목록 (questionId 순서로 정렬)
- 연습 모드 시작 버튼
- 문제 개별 삭제

### 8.4 연습 모드 (ReviewPractice)
- 문제 풀이 → 즉시 정답/오답 피드백
- 해설 표시
- AI 문제: 선지별 해설 표시
- 완료 시 정답률 표시

### 8.5 서재 퀴즈 상세 모달
- 제목, 문제 수, 태그, 난이도 표시
- 연습 시작 버튼
- 공개 업로드 버튼
- 삭제 버튼

---

## 9. 게시판 (뉴스)

### 9.1 탭 구조
- [To 교수님] - 질문/건의 (닉네임 고정)
- [우리들끼리] - 자유 게시판 (닉네임/익명 선택)

### 9.2 게시글 목록
- **고정글 캐러셀**: 상단에 교수님 고정글 슬라이드
- **Masonry 그리드**: 2열 레이아웃
- 좋아요 수, 댓글 수 표시
- 인기글 🔥 표시

### 9.3 글쓰기
- 제목 입력
- 내용 입력
- 사진 첨부 (선택)
- 작성자 공개 설정 (우리들끼리만): 닉네임/익명

### 9.4 글 상세
- 작성자 정보 (닉네임 또는 익명)
- 본문 + 이미지
- 좋아요 버튼
- 댓글 목록 및 작성

### 9.5 댓글 시스템
- 닉네임/익명 선택
- 대댓글 지원 (1단계)
- 본인 댓글 삭제 가능

### 9.6 도배 방지
- 글: 1분에 3개 제한
- 댓글: 30초에 1개 제한

---

## 10. 프로필 (설정)

### 10.1 프로필 드로어 (바텀시트)
- 프로필 이미지 + 닉네임
- 학적정보 (이름/학번/학년/반/과목)
- 알림 설정 토글
- 앱 정보
- 로그아웃/계정 삭제

### 10.2 알림 설정
- 공지 알림 (기본 ON)
- 새 퀴즈 알림 (기본 ON)
- 댓글 알림 (기본 ON)

---

## 11. 캐릭터 시스템

### 11.1 캐릭터 컨셉
- 귀여운 토끼 캐릭터
- 장비 착용 시 멋있어짐

### 11.2 캐릭터 생성
- 머리스타일: 짧은/중간/긴/묶음/대머리/닭머리/아프로/모히칸 등
- 피부색: 다양한 색상 선택
- 수염: 없음/콧수염/턱수염/풀수염

### 11.3 계급 시스템
| 계급 | 필요 경험치 | 갑옷 | 무기 |
|------|-------------|------|------|
| 견습생 | 0 | 천옷 | 당근 |
| 용사 | 50 | 가죽갑옷 | 나무칼 |
| 기사 | 100 | 사슬갑옷 | 단검 |
| 장군 | 150 | 철갑옷 | 검 |
| 대원수 | 200 | 금갑옷 | 대검 |
| 전설의 용사 | 250 | - | 당근검 |

---

## 12. 골드/경험치 시스템

### 12.1 경험치 획득
| 행동 | EXP |
|------|-----|
| 퀴즈 완료 | +10 |
| 정답 | +5 |
| 피드백 작성 | +10 |
| AI 퀴즈 완료 | +10 |
| 글 작성 | +3 |
| 댓글 작성 | +2 |

### 12.2 EXP 표시
- 획득 시 토스트 메시지로 표시
- 피드백 완료 후 또는 결과 화면 후 표시

---

## 13. 교수님 전용 기능

### 13.1 대시보드
- 총 학생 수
- 퀴즈 참여율
- 평균 점수
- 피드백 총합
- 반별 참여율

### 13.2 퀴즈 관리
- 퀴즈 생성 (모든 유형 지원)
- 퀴즈 수정/삭제
- 퀴즈 통계: 전체/반별 참여자, 점수 분포

### 13.3 학생 모니터링
- 반별 필터
- 학생 검색 (닉네임/이름/학번)
- 학생별 상세 성취도

### 13.4 문제 분석
- 오답률 높은 문제 표시
- 문제별 응답 분포
- 피드백 목록

### 13.5 게시판 관리
- 글/댓글 삭제 권한
- 공지로 전환 기능
- To 교수님: 학생 실명/학번 확인 가능

### 13.6 서술형 채점
- AI 보조 채점: Claude API + 루브릭 기반
- 수동 채점: 루브릭별 점수 입력

---

## 14. 보안

### 14.1 Firestore Security Rules
- 사용자는 자신의 데이터만 수정 가능
- `totalExp`, `rank`, `role`, `badges` 필드는 클라이언트 수정 불가
- Cloud Functions에서만 경험치/계급 처리

### 14.2 민감 필드 보호
```javascript
// ❌ 클라이언트에서 금지
await setDoc(doc(db, 'users', uid), {
  totalExp: 0,  // 금지
  rank: '견습생',  // 금지
});

// ✅ 허용
await setDoc(doc(db, 'users', uid), {
  onboardingCompleted: true,
  updatedAt: serverTimestamp(),
}, { merge: true });
```

---

## 15. 시즌 시스템

### 15.1 시즌 리셋 (중간 → 기말)
| 항목 | 리셋 여부 |
|------|-----------|
| 계급 | ✅ 초기화 |
| 갑옷/무기 | ✅ 초기화 |
| Shop 아이템 | ✅ 초기화 |
| 골드 | ❌ 유지 |
| 캐릭터 외형 | ❌ 유지 |
| 뱃지 | ❌ 유지 |

---

## 16. 알림 시스템

- Firebase Cloud Messaging (FCM) 사용
- 백그라운드/포그라운드 알림 지원
- 알림 설정에서 개별 토글

---

## 17. 구현 현황

### 17.1 퀴즈 탭 (75%)
- ✅ 퀴즈 목록 (탭 필터, 카드)
- ✅ 퀴즈 풀이/결과/피드백
- ✅ 퀴즈 생성 (OCR, 직접 입력)
- ✅ AI 퀴즈 생성 (서재)
- ✅ 완료 퀴즈 오버레이 표시
- ✅ 퀴즈 관리 (통계/수정/삭제)
- ⬜ 뉴스 스타일 캐러셀 (미구현)
- ⬜ 실시간 레이스 UI (미구현)

### 17.2 복습 탭 (85%)
- ✅ 4개 필터 (오답/찜/푼 문제/서재)
- ✅ 폴더 관리
- ✅ 연습 모드 (ReviewPractice)
- ✅ AI 문제 선지별 해설
- ✅ 서재 공개 업로드
- ⬜ 랜덤 풀기 (미구현)

### 17.3 게시판 탭 (90%)
- ✅ To 교수님 / 우리들끼리 탭
- ✅ 고정글 캐러셀
- ✅ Masonry 그리드
- ✅ 댓글 시스템
- ✅ 좋아요 기능
- ✅ 도배 방지

### 17.4 홈 화면 (미구현)
- ⬜ 캐릭터 표시
- ⬜ 반별 배경
- ⬜ 전적 카드
- ⬜ 공지 영역

---

## 18. 향후 계획

- 홈 화면 구현
- 뉴스 스타일 캐러셀 UI
- 캐릭터 애니메이션 (Lottie)
- Shop 시스템
- 뱃지 시스템
- 오프라인 모드 강화
